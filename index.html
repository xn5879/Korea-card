<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>éŸ“èªå­¸ç¿’ Pro</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; 
            --accent: #fbbf24; --again: #ff4d4d; --hard: #fb923c; 
            --good: #3b82f6; --easy: #22c55e; --bar-bg: #334155;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* é ‚éƒ¨é€²åº¦æ¢ */
        .header-stats { width: 100%; max-width: 400px; margin-bottom: 15px; background: rgba(30,41,59,0.5); padding: 10px; border-radius: 15px; }
        .stats-info { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold; }
        .progress-container { width: 100%; height: 10px; background: var(--bar-bg); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #fbbf24, #f59e0b); transition: width 0.5s ease; }
        
        /* æ¯é€±è¤‡ç¿’æé†’ */
        #weeklyAlert { width: 100%; max-width: 400px; background: var(--again); color: white; padding: 8px; border-radius: 10px; margin-bottom: 10px; font-size: 13px; text-align: center; display: none; cursor: pointer; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .controls { margin-bottom: 15px; display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
        select, button { padding: 8px 10px; border-radius: 8px; border: none; font-size: 13px; cursor: pointer; background: #334155; color: white; }
        
        /* å¡ç‰‡è¨­è¨ˆ */
        .container { perspective: 1000px; width: 100%; max-width: 340px; height: 380px; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
        .card.flip { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 24px; border: 2px solid #334155; background: var(--card); padding: 20px; box-sizing: border-box; text-align: center; }
        .back { transform: rotateY(180deg); border-color: var(--accent); }
        
        .ko { font-size: 40px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .zh { font-size: 28px; font-weight: bold; margin-bottom: 10px; }
        .ex { font-size: 14px; color: #94a3b8; line-height: 1.4; }

        .difficulty-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; margin-top: 15px; }
        .diff-btn { padding: 12px; border-radius: 10px; color: white; font-weight: bold; border: none; font-size: 12px; }

        .nav { margin-top: 15px; display: flex; align-items: center; gap: 20px; }
        .nav-btn { background: #334155; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        
        /* å‚™ä»½æŒ‰éˆ•å€ */
        .backup-zone { margin-top: 20px; font-size: 11px; opacity: 0.6; }
    </style>
</head>
<body>

    <div id="weeklyAlert" onclick="startWeeklyReview()">ğŸ“¢ æ¯é€±è¤‡ç¿’æ™‚é–“åˆ°ï¼é»æ­¤è¤‡ç¿’æœ¬é€±é›£é»</div>

    <div class="header-stats">
        <div class="stats-info">
            <span>ğŸ”¥ é€£å‹: <span id="streakDisplay">0</span> å¤©</span>
            <span>ç›®æ¨™: <span id="progressText">0 / 10</span></span>
        </div>
        <div class="progress-container">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>

    <div class="controls">
        <select id="ct" onchange="fltr()">
            <option value="å…¨éƒ¨">å…¨éƒ¨å–®å­—</option>
            <option value="æœ¬é€±è¤‡ç¿’">ğŸ“… æœ¬é€±è¤‡ç¿’(é›£é¡Œ)</option>
            <option value="å†æ¬¡">ğŸŸ¥ å†æ¬¡</option>
            <option value="å›°é›£">ğŸŸ§ å›°é›£</option>
            <option value="æ—¥å¸¸">æ—¥å¸¸</option><option value="ç”Ÿæ´»">ç”Ÿæ´»</option><option value="æƒ…ç·’">æƒ…ç·’</option>
        </select>
        <button onclick="qzM()" id="mb" style="background: var(--accent); color: #000;">åˆ‡æ›æ¸¬é©—</button>
    </div>

    <div class="container">
        <div class="card" id="wd" onclick="this.classList.toggle('flip')">
            <div class="face front" id="f"></div>
            <div class="face back" id="b"></div>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn" onclick="st(-1, event)">â†</button>
        <span id="pc">1 / 1000</span>
        <button class="nav-btn" onclick="st(1, event)">â†’</button>
    </div>

    <div class="backup-zone">
        <button onclick="exportData()">å°å‡ºå‚™ä»½</button>
        <button onclick="importData()">å°å…¥å‚™ä»½</button>
    </div>

<script>
// --- å–®å­—è³‡æ–™å€ (è«‹è²¼ä¸Šä½ åŸæœ¬çš„ 1000 å€‹å–®å­—) ---
const D = [{k:"ê³µë¶€í•˜ë‹¤", z:"å­¸ç¿’", e:"í•œêµ­ì–´ë¥¼ ê³µë¶€í•´ìš”.", c:"æ—¥å¸¸"},{k:"ì¼í•˜ë‹¤", z:"å·¥ä½œ", e:"íšŒì‚¬ì—ì„œ ì¼í•´ìš”.", c:"å·¥ä½œ"}]; 

// --- é‚è¼¯è™•ç†å€ ---
let L = [...D], id = 0, qz = false;
let stats = JSON.parse(localStorage.getItem('k_stats')) || { streak: 0, lastDate: '', todayCount: 0, learnedToday: [], lastWeekly: 0 };
let mastery = JSON.parse(localStorage.getItem('k_mastery')) || {}; 

function show() {
    const f = document.getElementById('f'), b = document.getElementById('b'), wd = document.getElementById('wd');
    const i = L[id];
    if (!i) { f.innerHTML = "ç›®å‰æ²’æœ‰å–®å­—"; return; }

    if (!qz) {
        f.innerHTML = `<div class="ko">${i.k}</div><button onclick="spk(event)" style="background:none;font-size:30px;border:none;">ğŸ”Š</button>`;
        b.innerHTML = `<div class="zh">${i.z}</div><div class="ex">${i.e}</div>
            <div class="difficulty-group">
                <button class="diff-btn" style="background:#ff4d4d" onclick="setDiff('${i.k}', 0, event)">å†æ¬¡</button>
                <button class="diff-btn" style="background:#fb923c" onclick="setDiff('${i.k}', 1, event)">å›°é›£</button>
                <button class="diff-btn" style="background:#3b82f6" onclick="setDiff('${i.k}', 2, event)">å°šå¯</button>
                <button class="diff-btn" style="background:#22c55e" onclick="setDiff('${i.k}', 3, event)">ç°¡å–®</button>
            </div>`;
    } else {
        f.innerHTML = `<div class="zh">${i.z}</div><input type="text" id="qi" placeholder="è¼¸å…¥éŸ“æ–‡..." onclick="event.stopPropagation()" style="width:80%;padding:10px;text-align:center;"><button onclick="chk(event)" style="margin-top:10px">æª¢æŸ¥</button><div id="ms" style="margin-top:10px"></div>`;
        b.innerHTML = `<div class="ko">${i.k}</div><div class="ex">${i.e}</div><button onclick="spk(event)" style="background:none;font-size:30px;border:none;">ğŸ”Š</button>`;
    }
    document.getElementById('pc').innerText = `${id + 1} / ${L.length}`;
    wd.classList.remove('flip');
    updateUI();
}

function setDiff(key, score, e) {
    if(e) e.stopPropagation();
    mastery[key] = { s: score, t: Date.now() }; // ç´€éŒ„åˆ†æ•¸èˆ‡æ™‚é–“
    localStorage.setItem('k_mastery', JSON.stringify(mastery));
    
    if (!stats.learnedToday.includes(key)) {
        stats.learnedToday.push(key);
        stats.todayCount++;
        saveStats();
    }
    st(1, e);
}

function updateUI() {
    const now = new Date();
    const todayStr = now.toDateString();
    
    // æª¢æŸ¥é€£å‹èˆ‡æ—¥æœŸæ›´æ–°
    if (stats.lastDate !== todayStr) {
        const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
        if (stats.lastDate !== yesterday.toDateString()) stats.streak = 0;
        stats.lastDate = todayStr;
        stats.todayCount = 0;
        stats.learnedToday = [];
        saveStats();
    }

    const currentGoal = Math.min(10 + Math.floor(stats.streak / 7) * 10, 50);
    const percent = Math.min((stats.todayCount / currentGoal) * 100, 100);
    
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressText').innerText = `${stats.todayCount} / ${currentGoal}`;
    document.getElementById('streakDisplay').innerText = stats.streak;

    if (percent === 100 && stats.lastGoalAchieved !== todayStr) {
        stats.streak++;
        stats.lastGoalAchieved = todayStr;
        saveStats();
        alert("ğŸ‰ é”æˆç›®æ¨™ï¼é€£å‹ +1");
    }

    // æ¯é€±è¤‡ç¿’æé†’é‚è¼¯ (7å¤©ä¸€æ¬¡)
    const sevenDays = 7 * 24 * 60 * 60 * 1000;
    if (Date.now() - stats.lastWeekly > sevenDays) {
        document.getElementById('weeklyAlert').style.display = 'block';
    }
}

function startWeeklyReview() {
    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
    L = D.filter(d => {
        const m = mastery[d.k];
        return m && m.t > sevenDaysAgo && (m.s === 0 || m.s === 1);
    });
    if (L.length === 0) {
        alert("æœ¬é€±è¡¨ç¾å®Œç¾ï¼Œæ²’æœ‰éœ€è¦è¤‡ç¿’çš„é›£é¡Œï¼");
        stats.lastWeekly = Date.now(); saveStats();
        document.getElementById('weeklyAlert').style.display = 'none';
        fltr();
    } else {
        id = 0; show();
        stats.lastWeekly = Date.now(); saveStats();
        document.getElementById('weeklyAlert').style.display = 'none';
        alert(`å·²ç‚ºä½ ç¯©é¸å‡ºæœ¬é€±ä¸ç†Ÿçš„ ${L.length} å€‹å–®å­—`);
    }
}

function fltr() {
    const v = document.getElementById('ct').value;
    if (v === "å…¨éƒ¨") L = [...D];
    else if (v === "å†æ¬¡") L = D.filter(d => mastery[d.k]?.s === 0);
    else if (v === "å›°é›£") L = D.filter(d => mastery[d.k]?.s === 1);
    else if (v === "æœ¬é€±è¤‡ç¿’") { startWeeklyReview(); return; }
    else L = D.filter(d => d.c === v);
    id = 0; show();
}

function chk(e) {
    e.stopPropagation();
    const v = document.getElementById('qi').value.trim(), c = L[id], m = document.getElementById('ms');
    if (v === c.k) { m.innerText = "âœ¨ æ­£ç¢º"; m.style.color = "#22c55e"; setDiff(c.k, 2); }
    else { m.innerText = "ğŸ’ª éŒ¯èª¤"; m.style.color = "#ff4d4d"; setDiff(c.k, 0); }
}

function exportData() {
    const data = JSON.stringify({stats, mastery});
    const blob = new Blob([data], {type: 'text/plain'});
    alert("è«‹è¤‡è£½ä»¥ä¸‹ä»£ç¢¼ä¸¦å­˜èµ·ä¾†ï¼š\n\n" + data);
}

function importData() {
    const data = prompt("è«‹è²¼ä¸Šå‚™ä»½ä»£ç¢¼ï¼š");
    if (data) {
        const parsed = JSON.parse(data);
        localStorage.setItem('k_stats', JSON.stringify(parsed.stats));
        localStorage.setItem('k_mastery', JSON.stringify(parsed.mastery));
        location.reload();
    }
}

function st(s, e) { if(e) e.stopPropagation(); id = (id + s + L.length) % L.length; show(); }
function qzM() { qz = !qz; document.getElementById('mb').innerText = qz ? "åˆ‡æ›å­¸ç¿’" : "åˆ‡æ›æ¸¬é©—"; show(); }
function spk(e) { e.stopPropagation(); window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(L[id].k); u.lang = 'ko-KR'; window.speechSynthesis.speak(u); }
function saveStats() { localStorage.setItem('k_stats', JSON.stringify(stats)); }

window.onload = show;
</script>
</body>
</html>
