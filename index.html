<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOPIK æ ¸å¿ƒå–®å­— (ä¿®å¾©å¼·åŒ–ç‰ˆ)</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; 
            --accent: #fbbf24; --again: #ff4d4d; --hard: #fb923c; 
            --good: #3b82f6; --easy: #22c55e; --bar-bg: #334155;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* ç‹€æ…‹åˆ—èˆ‡é€²åº¦æ¢ */
        .header-stats { width: 100%; max-width: 400px; margin-bottom: 15px; background: rgba(30,41,59,0.5); padding: 12px; border-radius: 15px; box-sizing: border-box; }
        .stats-info { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold; }
        .progress-container { width: 100%; height: 8px; background: var(--bar-bg); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #fbbf24, #f59e0b); transition: width 0.5s ease; }
        
        /* æ°£æ³¡æç¤º (å–ä»£ Alert) */
        #toast { position: fixed; top: 20px; background: #334155; color: white; padding: 12px 24px; border-radius: 12px; z-index: 1000; display: none; box-shadow: 0 8px 16px rgba(0,0,0,0.5); border: 1px solid var(--accent); animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        #weeklyAlert { width: 100%; max-width: 400px; background: var(--again); color: white; padding: 12px; border-radius: 10px; margin-bottom: 10px; font-size: 14px; text-align: center; display: none; cursor: pointer; font-weight: bold; }

        .controls { margin-bottom: 15px; display: flex; gap: 8px; width: 100%; max-width: 400px; }
        select, button { padding: 12px; border-radius: 10px; border: none; font-size: 14px; cursor: pointer; background: #334155; color: white; flex: 1; }
        
        /* å¡ç‰‡è¨­è¨ˆ */
        .container { perspective: 1000px; width: 100%; max-width: 340px; height: 380px; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
        .card.flip { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 24px; border: 2px solid #334155; background: var(--card); padding: 25px; box-sizing: border-box; text-align: center; }
        .back { transform: rotateY(180deg); border-color: var(--accent); }
        
        .ko { font-size: 45px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .zh { font-size: 35px; font-weight: bold; margin-bottom: 10px; color: #fff; }
        .ex { font-size: 16px; color: #94a3b8; line-height: 1.4; margin-top: 15px; }

        .difficulty-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; margin-top: 20px; }
        .diff-btn { padding: 12px; border-radius: 10px; color: white; font-weight: bold; border: none; font-size: 13px; }

        .nav { margin-top: 20px; display: flex; align-items: center; gap: 30px; }
        .nav-btn { background: #334155; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; border: none; color: white; }
        
        input#qi { width: 90%; padding: 15px; border-radius: 12px; border: 2px solid var(--bar-bg); background: #0f172a; color: white; text-align: center; font-size: 20px; margin: 15px 0; }
        .backup-btns { margin-top: 30px; display: flex; gap: 10px; opacity: 0.6; }
        .backup-btns button { padding: 8px 15px; font-size: 12px; flex: none; }
    </style>
</head>
<body>

    <div id="toast">æç¤ºè¨Šæ¯</div>
    <div id="weeklyAlert" onclick="startWeeklyReview()">ğŸ“¢ æ¯é€±è¤‡ç¿’æ™‚é–“åˆ°ï¼é»æ­¤è¤‡ç¿’æœ¬é€±é›£é»</div>

    <div class="header-stats">
        <div class="stats-info">
            <span>ğŸ”¥ é€£å‹: <span id="streakDisplay">0</span> å¤©</span>
            <span>ç›®æ¨™: <span id="progressText">0 / 10</span></span>
        </div>
        <div class="progress-container">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>

    <div class="controls">
        <select id="ct" onchange="fltr()">
            <option value="å…¨éƒ¨">å…¨éƒ¨å–®å­—</option>
            <option value="æœ¬é€±è¤‡ç¿’">ğŸ“… æ¯é€±è¤‡ç¿’</option>
            <option value="å†æ¬¡">ğŸŸ¥ å†æ¬¡ (æ¨™è¨˜)</option>
            <option value="å›°é›£">ğŸŸ§ å›°é›£ (æ¨™è¨˜)</option>
            <option disabled>â”€â”€ åˆ†é¡ â”€â”€</option>
            <option value="æ—¥å¸¸">æ—¥å¸¸</option>
            <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
            <option value="å·¥ä½œ">å·¥ä½œ</option>
            <option value="æƒ…ç·’">æƒ…ç·’</option>
            <option value="äº¤é€š">äº¤é€š</option>
            <option value="é£Ÿç‰©">é£Ÿç‰©</option>
        </select>
        <button onclick="qzM()" id="mb" style="background: var(--accent); color: #000; font-weight: bold;">åˆ‡æ›æ¸¬é©—</button>
    </div>

    <div class="container">
        <div class="card" id="wd" onclick="handleCardClick()">
            <div class="face front" id="f"></div>
            <div class="face back" id="b"></div>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn" onclick="st(-1, event)">â†</button>
        <span id="pc" style="font-weight: bold; min-width: 90px; text-align: center;">1 / 1000</span>
        <button class="nav-btn" onclick="st(1, event)">â†’</button>
    </div>

    <div class="backup-btns">
        <button onclick="exportData()">å°å‡ºå‚™ä»½</button>
        <button onclick="importData()">å°å…¥å‚™ä»½</button>
    </div>

<script>
// --- å–®å­—è³‡æ–™å€ (è«‹åœ¨æ­¤è²¼ä¸Šä½ å®Œæ•´çš„å–®å­—æ¸…å–®) ---
// --- å–®å­—è³‡æ–™å€ (å¤§é‡è£œå……ç‰ˆ) ---
const D = [
    // [æ—¥å¸¸] - åŸºç¤å‹•è©èˆ‡ç”Ÿæ´»ç”¨èª
    {k:"ê³µë¶€í•˜ë‹¤", z:"å­¸ç¿’", e:"í•œêµ­ì–´ë¥¼ ê³µë¶€í•´ìš”.", c:"æ—¥å¸¸"},
    {k:"ê°€ë‹¤", z:"å»", e:"í•™êµì— ê°€ìš”.", c:"æ—¥å¸¸"},
    {k:"ì˜¤ë‹¤", z:"ä¾†", e:"ì—¬ê¸°ì— ì˜¤ì„¸ìš”.", c:"æ—¥å¸¸"},
    {k:"ë¨¹ë‹¤", z:"åƒ", e:"ë°¥ì„ ë¨¹ì–´ìš”.", c:"æ—¥å¸¸"},
    {k:"ë§ˆì‹œë‹¤", z:"å–", e:"ë¬¼ ì£¼ì‹­ì‹œì˜¤.", c:"æ—¥å¸¸"},
    {k:"ìë‹¤", z:"ç¡è¦º", e:"ì–´ì ¯ë°¤ì— ì˜ ì¤ì–´ìš”?", c:"æ—¥å¸¸"},
    {k:"ë³´ë‹¤", z:"çœ‹", e:"ì˜í™”ë¥¼ ë´ìš”.", c:"æ—¥å¸¸"},
    {k:"ë“£ë‹¤", z:"è½", e:"ìŒì•…ì„ ë“¤ì–´ìš”.", c:"æ—¥å¸¸"},
    {k:"ë§í•˜ë‹¤", z:"èªª", e:"í•œêµ­ë§ë¡œ í•˜ì„¸ìš”.", c:"æ—¥å¸¸"},
    {k:"ì½ë‹¤", z:"è®€", e:"ì±…ì„ ì½ì–´ìš”.", c:"æ—¥å¸¸"},
    {k:"ì“°ë‹¤", z:"å¯«/æˆ´/è‹¦", e:"í¸ì§€ë¥¼ ì¨ìš”.", c:"æ—¥å¸¸"},
    {k:"ì•Œë‹¤", z:"çŸ¥é“", e:"ê·¸ ì‚¬ëŒì„ ì•Œì•„ìš”?", c:"æ—¥å¸¸"},
    {k:"ëª¨ë¥´ë‹¤", z:"ä¸çŸ¥é“", e:"ì˜ ëª¨ë¥´ê² ì–´ìš”.", c:"æ—¥å¸¸"},
    {k:"í•˜ë‹¤", z:"åš", e:"ë‚´ì¼ ë­ í•´ìš”?", c:"æ—¥å¸¸"},
    {k:"ì‚¬ë‹¤", z:"è²·", e:"ì‹œì¥ì—ì„œ ì˜·ì„ ì‚¬ìš”.", c:"æ—¥å¸¸"},
    {k:"ë§Œë‚˜ë‹¤", z:"é‡è¦‹/è¦‹é¢", e:"ì¹œêµ¬ë¥¼ ë§Œë‚˜ìš”.", c:"æ—¥å¸¸"},
    {k:"ê¸°ë‹¤ë¦¬ë‹¤", z:"ç­‰å¾…", e:"ì ê¹ë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.", c:"æ—¥å¸¸"},
    {k:"ì „í™”í•˜ë‹¤", z:"æ‰“é›»è©±", e:"ë¶€ëª¨ë‹˜ê»˜ ì „í™”í•´ìš”.", c:"æ—¥å¸¸"},
    {k:"ê³µì›", z:"å…¬åœ’", e:"ê³µì›ì—ì„œ ì‚°ì±…í•´ìš”.", c:"æ—¥å¸¸"},
    {k:"ì¹œêµ¬", z:"æœ‹å‹", e:"ì œ ì¹œêµ¬ëŠ” ì¹œì ˆí•´ìš”.", c:"æ—¥å¸¸"},
    {k:"í•™êµ", z:"å­¸æ ¡", e:"í•™êµê°€ ì•„ì£¼ ë©€ì–´ìš”.", c:"æ—¥å¸¸"},
    {k:"ì§‘", z:"å®¶", e:"ì§€ê¸ˆ ì§‘ì— ê°€ìš”.", c:"æ—¥å¸¸"},

    // [äº¤é€š] - å‡ºè¡Œèˆ‡é‹è¼¸
    {k:"ë²„ìŠ¤", z:"å…¬è»Š", e:"ë²„ìŠ¤ë¥¼ íƒ€ìš”.", c:"äº¤é€š"},
    {k:"ì§€í•˜ì² ", z:"åœ°éµ", e:"ì§€í•˜ì² ì—­ì´ ì–´ë””ì˜ˆìš”?", c:"äº¤é€š"},
    {k:"íƒì‹œ", z:"è¨ˆç¨‹è»Š", e:"íƒì‹œë¥¼ ì¡ì•„ìš”.", c:"äº¤é€š"},
    {k:"ê¸°ì°¨", z:"ç«è»Š", e:"ê¸°ì°¨í‘œë¥¼ ì˜ˆë§¤í•´ìš”.", c:"äº¤é€š"},
    {k:"ë¹„í–‰ê¸°", z:"é£›æ©Ÿ", e:"ë¹„í–‰ê¸°ë¥¼ íƒ€ê³  ê°€ìš”.", c:"äº¤é€š"},
    {k:"ì—­", z:"ç«™", e:"ê°•ë‚¨ì—­ì—ì„œ ë‚´ë ¤ìš”.", c:"äº¤é€š"},
    {k:"íƒ€ë‹¤", z:"æ­ä¹˜", e:"ìì „ê±°ë¥¼ íƒ€ìš”.", c:"äº¤é€š"},
    {k:"ë‚´ë¦¬ë‹¤", z:"ä¸‹è»Š", e:"ë‹¤ìŒ ì—­ì—ì„œ ë‚´ë ¤ìš”.", c:"äº¤é€š"},
    {k:"ê¸¸", z:"è·¯", e:"ê¸¸ì´ ë„ˆë¬´ ë§‰í˜€ìš”.", c:"äº¤é€š"},
    {k:"ê³µí•­", z:"æ©Ÿå ´", e:"ì¸ì²œê³µí•­ì— ê°€ìš”.", c:"äº¤é€š"},
    {k:"ì •ë¥˜ì¥", z:"åœé ç«™", e:"ë²„ìŠ¤ ì •ë¥˜ì¥ì´ ì–´ë””ì˜ˆìš”?", c:"äº¤é€š"},

    // [é£Ÿç‰©] - é£²é£Ÿèˆ‡å‘³é“
    {k:"ë°¥", z:"é£¯", e:"ë°¥ì„ ë¨¹ì—ˆìŠµë‹ˆê¹Œ?", c:"é£Ÿç‰©"},
    {k:"ë¬¼", z:"æ°´", e:"ë¬¼ ì¢€ ì£¼ì„¸ìš”.", c:"é£Ÿç‰©"},
    {k:"ê¹€ì¹˜", z:"æ³¡èœ", e:"ê¹€ì¹˜ê°€ ë§¤ì›Œìš”.", c:"é£Ÿç‰©"},
    {k:"ì»¤í”¼", z:"å’–å•¡", e:"ì»¤í”¼ í•œ ì” ë§ˆì…”ìš”.", c:"é£Ÿç‰©"},
    {k:"ì‚¬ê³¼", z:"è˜‹æœ", e:"ì‚¬ê³¼ê°€ ë§›ìˆì–´ìš”.", c:"é£Ÿç‰©"},
    {k:"ë¹µ", z:"éºµåŒ…", e:"ë¹µì§‘ì—ì„œ ë¹µì„ ì‚¬ìš”.", c:"é£Ÿç‰©"},
    {k:"ìš°ìœ ", z:"ç‰›å¥¶", e:"ë§¤ì¼ ìš°ìœ ë¥¼ ë§ˆì…”ìš”.", c:"é£Ÿç‰©"},
    {k:"ê³ ê¸°", z:"è‚‰", e:"ë¶ˆê³ ê¸°ë¥¼ ì¢‹ì•„í•´ìš”.", c:"é£Ÿç‰©"},
    {k:"ë§›ìˆë‹¤", z:"å¥½åƒ", e:"ì´ ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”.", c:"é£Ÿç‰©"},
    {k:"ë§µë‹¤", z:"è¾£", e:"í•œêµ­ ìŒì‹ì€ ì¡°ê¸ˆ ë§¤ì›Œìš”.", c:"é£Ÿç‰©"},
    {k:"ë‹¬ë‹¤", z:"ç”œ", e:"ì´ ì‚¬íƒ•ì€ ë„ˆë¬´ ë‹¬ì•„ìš”.", c:"é£Ÿç‰©"},
    {k:"ì‹œì¥", z:"å¸‚å ´", e:"ì‹œì¥ì—ì„œ ê³¼ì¼ì„ ì‚¬ìš”.", c:"é£Ÿç‰©"},

    // [å·¥ä½œ] - è·å ´èˆ‡å…¬å¸
    {k:"ì¼í•˜ë‹¤", z:"å·¥ä½œ", e:"íšŒì‚¬ì—ì„œ ì¼í•´ìš”.", c:"å·¥ä½œ"},
    {k:"íšŒì‚¬", z:"å…¬å¸", e:"ìš°ë¦¬ íšŒì‚¬ëŠ” í½ë‹ˆë‹¤.", c:"å·¥ä½œ"},
    {k:"íšŒì˜", z:"æœƒè­°", e:"ì§€ê¸ˆ íšŒì˜ ì¤‘ì´ì—ìš”.", c:"å·¥ä½œ"},
    {k:"ì‚¬ì¥ë‹˜", z:"è€é—†", e:"ì‚¬ì¥ë‹˜ì„ ë§Œë‚˜ìš”.", c:"å·¥ä½œ"},
    {k:"ì‚¬ë¬´ì‹¤", z:"è¾¦å…¬å®¤", e:"ì‚¬ë¬´ì‹¤ì´ 3ì¸µì— ìˆì–´ìš”.", c:"å·¥ä½œ"},
    {k:"ë™ë£Œ", z:"åŒäº‹", e:"íšŒì‚¬ ë™ë£Œì™€ ì¹œí•´ìš”.", c:"å·¥ä½œ"},
    {k:"ì„œë¥˜", z:"æ–‡ä»¶", e:"ì„œë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.", c:"å·¥ä½œ"},
    {k:"ë°”ì˜ë‹¤", z:"å¿™ç¢Œ", e:"ì˜¤ëŠ˜ì€ ë„ˆë¬´ ë°”ë¹ ìš”.", c:"å·¥ä½œ"},
    {k:"ëë‚˜ë‹¤", z:"çµæŸ", e:"ì¼ì´ 6ì‹œì— ëë‚˜ìš”.", c:"å·¥ä½œ"},
    {k:"ì¶œê·¼í•˜ë‹¤", z:"ä¸Šç­", e:"ì•„ì¹¨ 9ì‹œì— ì¶œê·¼í•´ìš”.", c:"å·¥ä½œ"},
    {k:"í‡´ê·¼í•˜ë‹¤", z:"ä¸‹ç­", e:"ì§€ê¸ˆ í‡´ê·¼í•˜ê³  ìˆì–´ìš”.", c:"å·¥ä½œ"},

    // [æƒ…ç·’] - å½¢å®¹è©èˆ‡å¿ƒæƒ…
    {k:"ê¸°ì˜ë‹¤", z:"é«˜èˆˆ", e:"ë§Œë‚˜ì„œ ê¸°ë»ìš”.", c:"æƒ…ç·’"},
    {k:"ìŠ¬í”„ë‹¤", z:"æ‚²å‚·", e:"ì˜í™”ê°€ ë„ˆë¬´ ìŠ¬í¼ìš”.", c:"æƒ…ç·’"},
    {k:"í–‰ë³µí•˜ë‹¤", z:"å¹¸ç¦", e:"ì •ë§ í–‰ë³µí•´ìš”.", c:"æƒ…ç·’"},
    {k:"í™”ë‚˜ë‹¤", z:"ç”Ÿæ°£", e:"ê°‘ìê¸° í™”ê°€ ë‚¬ì–´ìš”.", c:"æƒ…ç·’"},
    {k:"ë¬´ì„­ë‹¤", z:"å®³æ€•", e:"ë°¤ê¸¸ì´ ë¬´ì„œì›Œìš”.", c:"æƒ…ç·’"},
    {k:"ì¬ë¯¸ìˆë‹¤", z:"æœ‰è¶£", e:"í•œêµ­ ë“œë¼ë§ˆê°€ ì¬ë¯¸ìˆì–´ìš”.", c:"æƒ…ç·’"},
    {k:"í˜ë“¤ë‹¤", z:"è¾›è‹¦/ç´¯", e:"ìš”ì¦˜ ì¼ì´ í˜ë“¤ì–´ìš”.", c:"æƒ…ç·’"},
    {k:"ì‹¬ì‹¬í•˜ë‹¤", z:"ç„¡èŠ", e:"ì§‘ì—ì„œ í˜¼ì ì‹¬ì‹¬í•´ìš”.", c:"æƒ…ç·’"},
    {k:"ê±±ì •í•˜ë‹¤", z:"æ“”å¿ƒ", e:"ë„ˆë¬´ ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”.", c:"æƒ…ç·’"},

    // [ç”Ÿæ´»] - ç§‘æŠ€èˆ‡æ—¥å¸¸ç”¨å“
    {k:"ì¸í„°ë„·", z:"ç¶²è·¯", e:"ì¸í„°ë„·ì´ ë¹¨ë¼ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì›¹ì‚¬ì´íŠ¸", z:"ç¶²ç«™", e:"ì›¹ì‚¬ì´íŠ¸ ì£¼ì†Œê°€ ë­ì˜ˆìš”?", c:"ç”Ÿæ´»"},
    {k:"íœ´ëŒ€í°", z:"æ‰‹æ©Ÿ", e:"íœ´ëŒ€í°ì„ ìƒì–´ë²„ë ¸ì–´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì‚¬ì§„", z:"ç…§ç‰‡", e:"ì‚¬ì§„ì„ ì°ì–´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ëˆ", z:"éŒ¢", e:"ëˆì´ ì—†ì–´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì‡¼í•‘", z:"è³¼ç‰©", e:"ë°±í™”ì ì—ì„œ ì‡¼í•‘í•´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì˜·", z:"è¡£æœ", e:"ì˜ˆìœ ì˜·ì„ ì‚¬ê³  ì‹¶ì–´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì•ˆê²½", z:"çœ¼é¡", e:"ì•ˆê²½ì„ ì¨ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì‹œê³„", z:"æ‰‹éŒ¶/æ™‚é˜", e:"ì‹œê³„ë¥¼ ë´ìš”.", c:"ç”Ÿæ´»"},
    {k:"ì»´í“¨í„°", z:"é›»è…¦", e:"ì»´í“¨í„°ë¡œ ê³µë¶€í•´ìš”.", c:"ç”Ÿæ´»"}
];

let L = [...D], id = 0, qz = false;
let stats = JSON.parse(localStorage.getItem('k_stats')) || { streak: 0, lastDate: '', todayCount: 0, learnedToday: [], lastWeekly: 0 };
let mastery = JSON.parse(localStorage.getItem('k_mastery')) || {}; 

function show() {
    const f = document.getElementById('f'), b = document.getElementById('b'), wd = document.getElementById('wd');
    const i = L[id];
    if (!i) { 
        f.innerHTML = "æ­¤åˆ†é¡ç›®å‰æ²’æœ‰å–®å­—"; 
        b.innerHTML = "è«‹åˆ‡æ›åˆ†é¡";
        document.getElementById('pc').innerText = "0 / 0"; 
        return; 
    }

    if (!qz) {
        f.innerHTML = `<div class="ko">${i.k}</div><button onclick="spk(event)" style="background:none;font-size:40px;border:none;">ğŸ”Š</button>`;
        b.innerHTML = `<div class="zh">${i.z}</div><div class="ex">${i.e}</div>
            <div class="difficulty-group">
                <button class="diff-btn" style="background:var(--again)" onclick="setDiff('${i.k}', 0, true, event)">å†æ¬¡</button>
                <button class="diff-btn" style="background:var(--hard)" onclick="setDiff('${i.k}', 1, true, event)">å›°é›£</button>
                <button class="diff-btn" style="background:var(--good)" onclick="setDiff('${i.k}', 2, true, event)">å°šå¯</button>
                <button class="diff-btn" style="background:var(--easy)" onclick="setDiff('${i.k}', 3, true, event)">ç°¡å–®</button>
            </div>`;
    } else {
        f.innerHTML = `<div class="zh">${i.z}</div><input type="text" id="qi" placeholder="è¼¸å…¥éŸ“æ–‡..." onclick="event.stopPropagation()" onkeypress="if(event.key==='Enter')chk(event)"><button onclick="chk(event)" style="background:var(--good); color:white; width:90%; border-radius:12px; padding:12px; font-weight:bold;">æª¢æŸ¥ç­”æ¡ˆ</button><div id="ms" style="margin-top:15px; font-weight:bold; font-size:20px;"></div>`;
        b.innerHTML = `<div class="ko">${i.k}</div><div class="ex">${i.e}</div><button onclick="spk(event)" style="background:none;font-size:40px;border:none;">ğŸ”Š</button>`;
    }
    document.getElementById('pc').innerText = `${id + 1} / ${L.length}`;
    wd.classList.remove('flip');
    updateUI();
}

function handleCardClick() { if (!qz) document.getElementById('wd').classList.toggle('flip'); }

function setDiff(key, score, shouldMove, e) {
    if(e) e.stopPropagation();
    mastery[key] = { s: score, t: Date.now() };
    localStorage.setItem('k_mastery', JSON.stringify(mastery));
    if (!stats.learnedToday.includes(key)) {
        stats.learnedToday.push(key);
        stats.todayCount++;
        saveStats();
    }
    if (shouldMove) st(1);
}

function updateUI() {
    const todayStr = new Date().toDateString();
    if (stats.lastDate !== todayStr) {
        stats.lastDate = todayStr; stats.todayCount = 0; stats.learnedToday = []; saveStats();
    }
    const currentGoal = 10;
    const percent = Math.min((stats.todayCount / currentGoal) * 100, 100);
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressText').innerText = `${stats.todayCount} / ${currentGoal}`;
    document.getElementById('streakDisplay').innerText = stats.streak;
    const sevenDays = 7 * 24 * 60 * 60 * 1000;
    document.getElementById('weeklyAlert').style.display = (Date.now() - stats.lastWeekly > sevenDays) ? 'block' : 'none';
}

function showToast(msg) {
    const t = document.getElementById('toast');
    t.innerText = msg; t.style.display = 'block';
    setTimeout(() => { t.style.display = 'none'; }, 2500);
}

function startWeeklyReview() {
    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
    L = D.filter(d => {
        const m = mastery[d.k];
        return m && m.t > sevenDaysAgo && (m.s === 0 || m.s === 1);
    });
    if (L.length === 0) {
        showToast("æœ¬é€±è¡¨ç¾å®Œç¾ï¼Œæš«ç„¡é›£é¡Œï¼");
        stats.lastWeekly = Date.now(); saveStats();
        document.getElementById('ct').value = "å…¨éƒ¨"; fltr();
    } else {
        id = 0; show();
        stats.lastWeekly = Date.now(); saveStats();
        showToast(`å·²ç‚ºä½ æº–å‚™å¥½ ${L.length} å€‹é›£é¡Œè¤‡ç¿’`);
    }
}

function fltr() {
    const v = document.getElementById('ct').value;
    if (v === "å…¨éƒ¨") L = [...D];
    else if (v === "å†æ¬¡") L = D.filter(d => mastery[d.k]?.s === 0);
    else if (v === "å›°é›£") L = D.filter(d => mastery[d.k]?.s === 1);
    else if (v === "æœ¬é€±è¤‡ç¿’") { startWeeklyReview(); return; }
    else L = D.filter(d => d.c === v);
    id = 0; show();
}

function chk(e) {
    if(e) e.stopPropagation();
    const v = document.getElementById('qi').value.trim(), c = L[id], m = document.getElementById('ms');
    if (v === c.k) { 
        m.innerText = "âœ¨ æ­£ç¢ºï¼"; m.style.color = "var(--easy)"; 
        setDiff(c.k, 2, false); 
    } else { 
        m.innerText = `ğŸ’ª éŒ¯èª¤ï¼(æ­£è§£: ${c.k})`; m.style.color = "var(--again)"; 
        setDiff(c.k, 0, false); 
    }
}

function st(s, e) { if(e) e.stopPropagation(); if(L.length===0) return; id = (id + s + L.length) % L.length; show(); }
function qzM() { qz = !qz; document.getElementById('mb').innerText = qz ? "åˆ‡æ›å­¸ç¿’" : "åˆ‡æ›æ¸¬é©—"; show(); }
function spk(e) { e.stopPropagation(); window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(L[id].k); u.lang = 'ko-KR'; u.rate = 0.8; window.speechSynthesis.speak(u); }
function saveStats() { localStorage.setItem('k_stats', JSON.stringify(stats)); }
function exportData() { prompt("è«‹è¤‡è£½ä¸‹æ–¹æ–‡å­—ä½œç‚ºå‚™ä»½ï¼š", JSON.stringify({stats, mastery})); }
function importData() { const d = prompt("è²¼ä¸Šå‚™ä»½æ–‡å­—ï¼š"); if(d){ const p=JSON.parse(d); localStorage.setItem('k_stats', JSON.stringify(p.stats)); localStorage.setItem('k_mastery', JSON.stringify(p.mastery)); location.reload(); }}

window.onload = show;
</script>
</body>
</html>
