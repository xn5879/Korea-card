<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ“èªå­¸ç¿’ Pro (ä¿®å¾©ç‰ˆ)</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; 
            --accent: #fbbf24; --again: #ff4d4d; --hard: #fb923c; 
            --good: #3b82f6; --easy: #22c55e; --bar-bg: #334155;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        
        /* ç‹€æ…‹åˆ— */
        .header-stats { width: 100%; max-width: 400px; margin-bottom: 15px; background: rgba(30,41,59,0.5); padding: 10px; border-radius: 15px; box-sizing: border-box; }
        .stats-info { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold; }
        .progress-container { width: 100%; height: 10px; background: var(--bar-bg); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #fbbf24, #f59e0b); transition: width 0.5s ease; }
        
        /* é€šçŸ¥æç¤ºæ¡† (å–ä»£ alert) */
        #toast { position: fixed; top: 20px; background: #334155; color: white; padding: 12px 20px; border-radius: 10px; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.5); border-left: 4px solid var(--accent); }

        #weeklyAlert { width: 100%; max-width: 400px; background: var(--again); color: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; font-size: 13px; text-align: center; display: none; cursor: pointer; }

        .controls { margin-bottom: 15px; display: flex; gap: 8px; width: 100%; max-width: 400px; }
        select, button { padding: 10px; border-radius: 8px; border: none; font-size: 14px; cursor: pointer; background: #334155; color: white; flex: 1; }
        
        /* å¡ç‰‡ */
        .container { perspective: 1000px; width: 100%; max-width: 340px; height: 380px; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
        .card.flip { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 24px; border: 2px solid #334155; background: var(--card); padding: 20px; box-sizing: border-box; text-align: center; }
        .back { transform: rotateY(180deg); border-color: var(--accent); }
        
        .ko { font-size: 42px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .zh { font-size: 32px; font-weight: bold; margin-bottom: 10px; }
        .ex { font-size: 15px; color: #94a3b8; line-height: 1.4; margin-top: 10px; }

        .difficulty-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; margin-top: 15px; }
        .diff-btn { padding: 12px; border-radius: 10px; color: white; font-weight: bold; border: none; font-size: 12px; }

        .nav { margin-top: 20px; display: flex; align-items: center; gap: 25px; }
        .nav-btn { background: #334155; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: none; color: white; }
        
        input#qi { width: 85%; padding: 12px; border-radius: 10px; border: 2px solid var(--bar-bg); background: #0f172a; color: white; text-align: center; font-size: 18px; margin: 15px 0; }
        .backup-btns { margin-top: 30px; display: flex; gap: 10px; opacity: 0.5; }
        .backup-btns button { padding: 5px 10px; font-size: 11px; }
    </style>
</head>
<body>

    <div id="toast">æç¤ºè¨Šæ¯</div>
    <div id="weeklyAlert" onclick="startWeeklyReview()">ğŸ“¢ æ¯é€±è¤‡ç¿’æ™‚é–“åˆ°ï¼é»æ­¤è¤‡ç¿’æœ¬é€±é›£é»</div>

    <div class="header-stats">
        <div class="stats-info">
            <span>ğŸ”¥ é€£å‹: <span id="streakDisplay">0</span> å¤©</span>
            <span>ç›®æ¨™: <span id="progressText">0 / 10</span></span>
        </div>
        <div class="progress-container">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>

    <div class="controls">
        <select id="ct" onchange="fltr()">
            <option value="å…¨éƒ¨">å…¨éƒ¨å–®å­—</option>
            <option value="æœ¬é€±è¤‡ç¿’">ğŸ“… æœ¬é€±è¤‡ç¿’</option>
            <option value="å†æ¬¡">ğŸŸ¥ å†æ¬¡</option>
            <option value="å›°é›£">ğŸŸ§ å›°é›£</option>
        </select>
        <button onclick="qzM()" id="mb" style="background: var(--accent); color: #000; font-weight: bold;">åˆ‡æ›æ¸¬é©—</button>
    </div>

    <div class="container">
        <div class="card" id="wd" onclick="handleCardClick()">
            <div class="face front" id="f"></div>
            <div class="face back" id="b"></div>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn" onclick="st(-1, event)">â†</button>
        <span id="pc" style="font-weight: bold; min-width: 80px; text-align: center;">1 / 1000</span>
        <button class="nav-btn" onclick="st(1, event)">â†’</button>
    </div>

    <div class="backup-btns">
        <button onclick="exportData()">å°å‡ºå‚™ä»½</button>
        <button onclick="importData()">å°å…¥å‚™ä»½</button>
    </div>

<script>
// --- ğŸ”´ é‡è¦ï¼šè«‹åœ¨æ­¤è™• [ ] å…§è²¼ä¸Šä½ åŸæœ¬çš„ 1000 å€‹å–®å­—è³‡æ–™ ---
const D = [
    {k:"ê³µë¶€í•˜ë‹¤", z:"å­¸ç¿’", e:"í•œêµ­ì–´ë¥¼ ê³µë¶€í•´ìš”.", c:"æ—¥å¸¸"},
    {k:"ì¼í•˜ë‹¤", z:"å·¥ä½œ", e:"íšŒì‚¬ì—ì„œ ì¼í•´ìš”.", c:"å·¥ä½œ"}
    // ... ä¹‹å¾Œè«‹æŠŠå…¶é¤˜å–®å­—è£œåœ¨é€™è£¡ ...
]; 

let L = [...D], id = 0, qz = false;
let stats = JSON.parse(localStorage.getItem('k_stats')) || { streak: 0, lastDate: '', todayCount: 0, learnedToday: [], lastWeekly: 0 };
let mastery = JSON.parse(localStorage.getItem('k_mastery')) || {}; 

function show() {
    const f = document.getElementById('f'), b = document.getElementById('b'), wd = document.getElementById('wd');
    const i = L[id];
    if (!i) { f.innerHTML = "ç›®å‰æ²’æœ‰ç¬¦åˆçš„å–®å­—"; document.getElementById('pc').innerText = "0 / 0"; return; }

    if (!qz) {
        f.innerHTML = `<div class="ko">${i.k}</div><button onclick="spk(event)" style="background:none;font-size:35px;border:none;">ğŸ”Š</button>`;
        b.innerHTML = `<div class="zh">${i.z}</div><div class="ex">${i.e}</div>
            <div class="difficulty-group">
                <button class="diff-btn" style="background:var(--again)" onclick="setDiff('${i.k}', 0, true, event)">å†æ¬¡</button>
                <button class="diff-btn" style="background:var(--hard)" onclick="setDiff('${i.k}', 1, true, event)">å›°é›£</button>
                <button class="diff-btn" style="background:var(--good)" onclick="setDiff('${i.k}', 2, true, event)">å°šå¯</button>
                <button class="diff-btn" style="background:var(--easy)" onclick="setDiff('${i.k}', 3, true, event)">ç°¡å–®</button>
            </div>`;
    } else {
        f.innerHTML = `<div class="zh">${i.z}</div><input type="text" id="qi" placeholder="è¼¸å…¥éŸ“æ–‡..." onclick="event.stopPropagation()" onkeypress="if(event.key==='Enter')chk(event)"><button onclick="chk(event)" style="background:var(--good); color:white; width:80%; border-radius:10px;">æª¢æŸ¥ç­”æ¡ˆ</button><div id="ms" style="margin-top:15px; font-weight:bold; font-size:18px;"></div>`;
        b.innerHTML = `<div class="ko">${i.k}</div><div class="ex">${i.e}</div><button onclick="spk(event)" style="background:none;font-size:35px;border:none;">ğŸ”Š</button>`;
    }
    document.getElementById('pc').innerText = `${id + 1} / ${L.length}`;
    wd.classList.remove('flip');
    updateUI();
}

function handleCardClick() {
    if (!qz) {
        document.getElementById('wd').classList.toggle('flip');
    }
}

function setDiff(key, score, shouldMove, e) {
    if(e) e.stopPropagation();
    mastery[key] = { s: score, t: Date.now() };
    localStorage.setItem('k_mastery', JSON.stringify(mastery));
    
    if (!stats.learnedToday.includes(key)) {
        stats.learnedToday.push(key);
        stats.todayCount++;
        saveStats();
    }
    if (shouldMove) st(1);
}

function updateUI() {
    const todayStr = new Date().toDateString();
    if (stats.lastDate !== todayStr) {
        stats.lastDate = todayStr; stats.todayCount = 0; stats.learnedToday = []; saveStats();
    }
    const currentGoal = 10;
    const percent = Math.min((stats.todayCount / currentGoal) * 100, 100);
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressText').innerText = `${stats.todayCount} / ${currentGoal}`;
    document.getElementById('streakDisplay').innerText = stats.streak;

    const sevenDays = 7 * 24 * 60 * 60 * 1000;
    document.getElementById('weeklyAlert').style.display = (Date.now() - stats.lastWeekly > sevenDays) ? 'block' : 'none';
}

function showToast(msg) {
    const t = document.getElementById('toast');
    t.innerText = msg; t.style.display = 'block';
    setTimeout(() => { t.style.display = 'none'; }, 3000);
}

function startWeeklyReview() {
    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
    L = D.filter(d => {
        const m = mastery[d.k];
        return m && m.t > sevenDaysAgo && (m.s === 0 || m.s === 1);
    });
    
    if (L.length === 0) {
        showToast("æœ¬é€±è¡¨ç¾å®Œç¾ï¼Œæš«ç„¡é›£é¡Œï¼");
        stats.lastWeekly = Date.now(); saveStats();
        fltr();
    } else {
        id = 0; show();
        stats.lastWeekly = Date.now(); saveStats();
        showToast(`å·²ç¯©é¸å‡ºæœ¬é€±ä¸ç†Ÿçš„ ${L.length} å€‹å–®å­—`);
    }
}

function fltr() {
    const v = document.getElementById('ct').value;
    if (v === "å…¨éƒ¨") L = [...D];
    else if (v === "å†æ¬¡") L = D.filter(d => mastery[d.k]?.s === 0);
    else if (v === "å›°é›£") L = D.filter(d => mastery[d.k]?.s === 1);
    else if (v === "æœ¬é€±è¤‡ç¿’") { startWeeklyReview(); return; }
    id = 0; show();
}

function chk(e) {
    e.stopPropagation();
    const v = document.getElementById('qi').value.trim(), c = L[id], m = document.getElementById('ms');
    if (v === c.k) { 
        m.innerText = "âœ¨ æ­£ç¢ºï¼"; m.style.color = "var(--easy)"; 
        setDiff(c.k, 2, false); 
    } else { 
        m.innerText = `ğŸ’ª éŒ¯èª¤ (æ­£ç¢ºæ˜¯: ${c.k})`; m.style.color = "var(--again)"; 
        setDiff(c.k, 0, false); 
    }
}

function st(s, e) { if(e) e.stopPropagation(); if(L.length===0) return; id = (id + s + L.length) % L.length; show(); }
function qzM() { qz = !qz; document.getElementById('mb').innerText = qz ? "åˆ‡æ›å­¸ç¿’" : "åˆ‡æ›æ¸¬é©—"; show(); }
function spk(e) { e.stopPropagation(); window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(L[id].k); u.lang = 'ko-KR'; window.speechSynthesis.speak(u); }
function saveStats() { localStorage.setItem('k_stats', JSON.stringify(stats)); }
function exportData() { prompt("è«‹è¤‡è£½é€²åº¦ä»£ç¢¼ï¼š", JSON.stringify({stats, mastery})); }
function importData() { const d = prompt("è²¼ä¸Šå‚™ä»½ä»£ç¢¼ï¼š"); if(d){ const p=JSON.parse(d); localStorage.setItem('k_stats', JSON.stringify(p.stats)); localStorage.setItem('k_mastery', JSON.stringify(p.mastery)); location.reload(); }}

window.onload = show;
</script>
</body>
</html>
